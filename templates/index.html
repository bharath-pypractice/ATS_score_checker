<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResumeLab AI | Premium Analysis</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        :root {
            --brand-primary: #6366f1;
            --brand-secondary: #10b981;
            --bg-dark: #020617;
            --card-bg: rgba(30, 41, 59, 0.5);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.15) 0%, transparent 35%),
                radial-gradient(circle at 100% 100%, rgba(16, 185, 129, 0.1) 0%, transparent 35%);
            background-attachment: fixed;
            color: #f8fafc;
            min-height: 100vh;
        }

        /* Glassmorphism */
        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.03);
        }

        /* Animations */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-slide-up {
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .chat-bubble-bot {
            border-bottom-left-radius: 2px;
        }

        .chat-bubble-user {
            border-bottom-right-radius: 2px;
            background: linear-gradient(135deg, #4f46e5, #6366f1);
        }

        /* Score Gauge Animation */
        .score-circle {
            transition: stroke-dashoffset 1s ease-in-out;
            stroke-linecap: round;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--brand-secondary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Markdown Styling */
        .prose h3 { font-weight: 700; margin-bottom: 0.5rem; color: #818cf8; }
        .prose p { margin-bottom: 0.75rem; line-height: 1.6; }
        .prose ul { list-style-type: disc; padding-left: 1.25rem; margin-bottom: 0.75rem; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <!-- Navbar -->
    <nav class="flex items-center justify-between px-8 py-4 border-b border-white/5 glass sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <div class="bg-indigo-600 p-2 rounded-lg">
                <i data-lucide="layers" class="w-5 h-5 text-white"></i>
            </div>
            <span class="text-xl font-bold tracking-tight">ResumeLab <span class="text-indigo-400 font-extrabold italic">AI</span></span>
        </div>
        <div class="flex items-center gap-4 text-sm text-slate-400">
            <span class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span> System Ready</span>
        </div>
    </nav>

    <main class="flex-1 flex flex-col md:flex-row overflow-hidden p-4 md:p-6 gap-6">
        
        <!-- Sidebar: Upload & Analysis -->
        <aside class="md:w-80 lg:w-96 flex flex-col gap-6 overflow-y-auto">
            
            <!-- Upload Card -->
            <div class="glass rounded-2xl p-6 animate-slide-up" style="animation-delay: 0.1s">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-slate-400 mb-4 flex items-center gap-2">
                    <i data-lucide="upload-cloud" class="w-4 h-4"></i> Document Input
                </h3>
                
                <div id="dropZone" 
                     class="border-2 border-dashed border-slate-700 hover:border-indigo-500 rounded-xl p-8 text-center transition-all cursor-pointer bg-slate-900/50 group"
                     onclick="document.getElementById('resumeFile').click()">
                    <input type="file" id="resumeFile" class="hidden" accept=".pdf" onchange="handleFile(this)">
                    <div class="flex flex-col items-center">
                        <div class="p-3 rounded-full bg-indigo-500/10 group-hover:bg-indigo-500/20 transition-colors mb-3">
                            <i data-lucide="file-plus" class="w-8 h-8 text-indigo-400"></i>
                        </div>
                        <p class="text-sm font-medium text-slate-300">Drop PDF here or click</p>
                        <p class="text-xs text-slate-500 mt-1">Maximum size 5MB</p>
                    </div>
                </div>

                <div id="fileInfo" class="mt-4 hidden animate-slide-up">
                    <div class="bg-slate-900/80 rounded-lg p-3 flex items-center gap-3 border border-white/5">
                        <i data-lucide="file-text" class="w-5 h-5 text-emerald-400"></i>
                        <div class="flex-1 min-w-0">
                            <p id="fileName" class="text-xs font-medium truncate"></p>
                            <p class="text-[10px] text-emerald-400">Ready to analyze</p>
                        </div>
                        <button onclick="handleFile(null)" class="text-slate-500 hover:text-red-400 transition-colors">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <button id="analyzeBtn" onclick="analyzeResume()" 
                        class="w-full mt-4 py-3 bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-xl font-bold transition-all flex items-center justify-center gap-2 shadow-lg shadow-indigo-900/20">
                    <i data-lucide="zap" class="w-4 h-4"></i>
                    <span id="analyzeText">Analyze Score</span>
                </button>
            </div>

            <!-- Score Visual -->
            <div id="scoreSection" class="glass rounded-2xl p-6 flex-1 flex flex-col items-center justify-center animate-slide-up opacity-40 transition-opacity duration-500" style="animation-delay: 0.2s">
                <h3 class="text-sm font-semibold uppercase tracking-wider text-slate-400 mb-6 self-start flex items-center gap-2">
                    <i data-lucide="activity" class="w-4 h-4"></i> ATS Compatibility
                </h3>
                
                <div class="relative flex items-center justify-center">
                    <!-- Gauge -->
                    <svg class="w-48 h-48 transform -rotate-90">
                        <circle cx="96" cy="96" r="80" stroke="currentColor" stroke-width="12" fill="transparent" class="text-slate-800" />
                        <circle id="scoreCircle" cx="96" cy="96" r="80" stroke="currentColor" stroke-width="12" fill="transparent" 
                                stroke-dasharray="502.6" stroke-dashoffset="502.6" class="text-indigo-500 score-circle" />
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span id="scoreValue" class="text-5xl font-black text-white">0</span>
                        <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Percent</span>
                    </div>
                </div>
                
                <div class="mt-8 grid grid-cols-2 gap-4 w-full">
                    <div class="bg-slate-900/50 p-3 rounded-xl border border-white/5">
                        <p class="text-[10px] uppercase text-slate-500 font-bold mb-1">Keywords</p>
                        <p class="text-sm font-semibold text-emerald-400">Pending</p>
                    </div>
                    <div class="bg-slate-900/50 p-3 rounded-xl border border-white/5">
                        <p class="text-[10px] uppercase text-slate-500 font-bold mb-1">Structure</p>
                        <p class="text-sm font-semibold text-indigo-400">Pending</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <section class="flex-1 glass rounded-2xl flex flex-col overflow-hidden animate-slide-up" style="animation-delay: 0.3s">
            <!-- Chat Header -->
            <div class="px-6 py-4 border-b border-white/5 bg-slate-900/40 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center border border-indigo-500/30 text-indigo-400">
                        <i data-lucide="bot" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h2 class="font-bold text-sm">Resume Expert AI</h2>
                        <p class="text-[11px] text-slate-400">Expert Career Consultant ‚Ä¢ GPT-4o Powered</p>
                    </div>
                </div>
                <button onclick="clearChat()" class="p-2 text-slate-500 hover:text-white transition-colors" title="Clear Chat">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                </button>
            </div>

            <!-- Messages -->
            <div id="chatArea" class="flex-1 overflow-y-auto p-6 space-y-6">
                <!-- Welcome Message -->
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center flex-shrink-0 border border-white/10">
                        <i data-lucide="bot" class="w-4 h-4 text-indigo-400"></i>
                    </div>
                    <div class="bg-slate-800/80 p-4 rounded-2xl chat-bubble-bot text-sm max-w-[85%] border border-white/5 shadow-sm">
                        Hello! I'm your ResumeLab AI assistant. üöÄ <br><br>
                        Please **upload your resume** on the left to begin. I can analyze your ATS score, suggest improvements, or help you tailor it for specific job descriptions.
                    </div>
                </div>
            </div>

            <!-- Input -->
            <div class="p-4 bg-slate-900/60 border-t border-white/5">
                <div class="max-w-4xl mx-auto flex items-center gap-3 bg-slate-800 rounded-2xl p-1.5 border border-white/10 focus-within:border-indigo-500/50 transition-all shadow-inner">
                    <input id="userInput" 
                           class="flex-1 bg-transparent px-4 py-2.5 text-sm focus:outline-none placeholder-slate-500"
                           placeholder="Ask about your experience, skills, or gaps..."
                           onkeypress="if(event.key==='Enter')sendMessage()">
                    <button onclick="sendMessage()" 
                            class="bg-indigo-600 hover:bg-indigo-500 w-10 h-10 flex items-center justify-center rounded-xl text-white transition-all transform active:scale-95 shadow-md">
                        <i data-lucide="arrow-up" class="w-5 h-5"></i>
                    </button>
                </div>
                <p class="text-center text-[10px] text-slate-500 mt-2">AI can make mistakes. Verify important information.</p>
            </div>
        </section>

    </main>

    <script>
        // Initializations
        const chatArea = document.getElementById("chatArea");
        const scoreSection = document.getElementById("scoreSection");
        const scoreValue = document.getElementById("scoreValue");
        const scoreCircle = document.getElementById("scoreCircle");
        const fileInfo = document.getElementById("fileInfo");
        const fileNameDisplay = document.getElementById("fileName");

        lucide.createIcons();
        marked.setOptions({ breaks: true });

        function updateGauge(score) {
            const circumference = 2 * Math.PI * 80;
            const offset = circumference - (score / 100) * circumference;
            scoreCircle.style.strokeDashoffset = offset;
            
            // Animate number
            let start = 0;
            const duration = 1000;
            const stepTime = 20;
            const steps = duration / stepTime;
            const increment = score / steps;

            const timer = setInterval(() => {
                start += increment;
                if (start >= score) {
                    scoreValue.innerText = Math.round(score);
                    clearInterval(timer);
                } else {
                    scoreValue.innerText = Math.round(start);
                }
            }, stepTime);
        }

        function addMessage(text, role) {
            const isBot = role === "bot";
            const container = document.createElement("div");
            container.className = `flex ${isBot ? 'items-start' : 'items-end flex-row-reverse'} gap-3 animate-slide-up`;
            
            const iconHtml = isBot ? 
                `<div class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center flex-shrink-0 border border-white/10"><i data-lucide="bot" class="w-4 h-4 text-indigo-400"></i></div>` : 
                `<div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center flex-shrink-0 shadow-lg"><i data-lucide="user" class="w-4 h-4 text-white"></i></div>`;

            const bubbleClass = isBot ? 
                "bg-slate-800/80 chat-bubble-bot border-white/5" : 
                "chat-bubble-user text-white shadow-lg";

            container.innerHTML = `
                ${iconHtml}
                <div class="p-4 rounded-2xl ${bubbleClass} text-sm max-w-[85%] border shadow-sm prose prose-invert">
                    ${isBot ? marked.parse(text) : text}
                </div>
            `;
            
            chatArea.appendChild(container);
            chatArea.scrollTop = chatArea.scrollHeight;
            lucide.createIcons();
        }

        function showTyping() {
            const t = document.createElement("div");
            t.id = "typing-indicator";
            t.className = "flex items-start gap-3 animate-slide-up";
            t.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center flex-shrink-0 border border-white/10">
                    <i data-lucide="bot" class="w-4 h-4 text-indigo-400"></i>
                </div>
                <div class="bg-slate-800/80 p-4 rounded-2xl chat-bubble-bot border border-white/5 flex gap-1">
                    <span class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce"></span>
                    <span class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                    <span class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></span>
                </div>
            `;
            chatArea.appendChild(t);
            chatArea.scrollTop = chatArea.scrollHeight;
            lucide.createIcons();
        }

        function removeTyping() {
            const t = document.getElementById("typing-indicator");
            if (t) t.remove();
        }

        function handleFile(input) {
            if (!input) {
                fileInfo.classList.add("hidden");
                document.getElementById('resumeFile').value = '';
                return;
            }
            const file = input.files[0];
            if (!file) return;

            fileNameDisplay.innerText = file.name;
            fileInfo.classList.remove("hidden");

            const fd = new FormData();
            fd.append("resume", file);

            fetch("/upload", { method: "POST", body: fd })
                .then(res => {
                    if(res.ok) addMessage(`Successfully uploaded: **${file.name}**`, "bot");
                })
                .catch(() => addMessage("Upload failed. Please try again.", "bot"));
        }

        function analyzeResume() {
            const btn = document.getElementById("analyzeBtn");
            const txt = document.getElementById("analyzeText");

            btn.disabled = true;
            txt.innerHTML = `<div class="spinner"></div> Processing AI Model`;

            fetch("/analyze", { method: "POST" })
                .then(res => res.json())
                .then(data => {
                    btn.disabled = false;
                    txt.innerHTML = `Analyze Score`;

                    if (data.status === "ok") {
                        scoreSection.classList.remove("opacity-40");
                        updateGauge(data.ats_score);
                        addMessage(`### üìà Analysis Results\n**Score:** ${data.ats_score}/100\n\n${data.feedback}`, "bot");
                    } else {
                        addMessage("Please upload a resume first to begin the analysis. ‚ö†Ô∏è", "bot");
                    }
                })
                .catch(() => {
                    btn.disabled = false;
                    txt.innerText = "Analyze Score";
                    addMessage("Communication error with the server. Please check your connection.", "bot");
                });
        }

        function sendMessage() {
            const input = document.getElementById("userInput");
            const msg = input.value.trim();
            if (!msg) return;

            addMessage(msg, "user");
            input.value = "";
            showTyping();

            fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: msg })
            })
            .then(res => res.json())
            .then(data => {
                removeTyping();
                addMessage(data.reply, "bot");
            })
            .catch(() => {
                removeTyping();
                addMessage("I'm having trouble processing that right now. ‚ùå", "bot");
            });
        }

        function clearChat() {
            chatArea.innerHTML = '';
            addMessage("Chat history cleared. How can I help you with your resume today?", "bot");
        }
    </script>
</body>
</html>